# 需求文档

## 引言

本次迭代包含两个新特性和一个 Bug 修复，围绕录音列表界面和会谈纪要界面进行体验优化。

**现状分析：**
- 录音列表界面（`RecordListScreen.kt`）已有按联系人分组（`groupBy`）的逻辑，每个分组有 `ContactGroupHeader`，但分组内的每条记录（`BrandRecordItem`）仍然显示联系人名称，且不支持折叠/展开。
- `CallRecordEntity` 中 `contactName` 字段可为 null，此时使用 `phoneNumber` 作为显示名。当前无法手动编辑联系人名称。
- `MinuteDetailScreen.kt` 中参与者使用 `Row` + `Arrangement.spacedBy(8.dp)` 横向排列，当参与者名字较长或数量较多时容易溢出、错位。

---

## 需求

### 需求 1：录音列表按联系人折叠

**用户故事：** 作为一名通话记录较多的用户，我希望录音列表能够按联系人折叠/展开，以便在联系人较多时快速浏览和定位。

#### 验收标准

1. WHEN 用户进入录音列表界面 THEN 系统 SHALL 按联系人分组显示录音记录，每个分组的 Header 显示联系人名称、录音数量，以及一个折叠/展开图标按钮。
2. WHEN 用户点击某个联系人分组的 Header 或折叠按钮 THEN 系统 SHALL 切换该分组的折叠/展开状态：
   - 展开状态：显示该联系人下的所有录音记录卡片。
   - 折叠状态：隐藏该联系人下的所有录音记录卡片，仅保留分组 Header。
3. WHEN 录音列表首次加载时 THEN 系统 SHALL 默认所有分组为**展开**状态。
4. WHEN 分组内的录音记录显示时 THEN 每条记录卡片 SHALL **不再显示联系人名称**（因为分组 Header 已显示联系人信息），仅显示以下信息：
   - 录音时间
   - 录音时长
   - 处理状态徽章（转写/纪要状态）
   - 更多操作菜单
5. WHEN 折叠/展开状态切换时 THEN 系统 SHALL 使用动画过渡效果（`AnimatedVisibility`），提供流畅的用户体验。

#### 边界情况
- 仅有一条记录的联系人分组也应支持折叠/展开操作。
- 搜索状态下分组默认全部展开，不支持折叠。

---

### 需求 2：手动编辑联系人名称

**用户故事：** 作为一名用户，当录音的联系人名称为空（仅显示手机号）时，我希望能够手动编辑联系人名称，以便更好地识别和管理录音记录。

#### 验收标准

1. IF 某条录音记录的 `contactName` 为 null 或空字符串（即仅有手机号显示）THEN 系统 SHALL 在录音列表的联系人分组 Header 上显示一个编辑图标按钮。
2. WHEN 用户点击编辑图标按钮 THEN 系统 SHALL 弹出一个编辑对话框（`AlertDialog`），包含：
   - 标题："编辑联系人名称"
   - 当前手机号显示（仅作参考，不可编辑）
   - 一个文本输入框，用于输入联系人名称
   - "确认" 和 "取消" 按钮
3. WHEN 用户输入联系人名称并点击"确认" THEN 系统 SHALL 将该联系人名称更新到**同一手机号的所有录音记录**的 `contactName` 字段中。
4. WHEN 联系人名称更新成功 THEN 系统 SHALL 立即刷新录音列表界面，分组 Header 显示新的联系人名称。
5. IF 用户输入为空字符串 THEN 系统 SHALL 不允许确认提交，按钮应置灰。

#### 边界情况
- 同一手机号可能有多条录音记录，编辑后应统一更新所有记录的联系人名称。
- 编辑后分组会重新归类（原来以手机号为分组 key，编辑后以新的联系人名称为 key）。

---

### 需求 3（Bugfix）：会谈纪要参与者改为纵向排列

**用户故事：** 作为一名查看会谈纪要的用户，我希望参与者列表采用纵向排列，以便在参与者名字较长时也能完整显示，不出现对齐问题。

#### 验收标准

1. WHEN 会谈纪要详情页显示参与者区域时 THEN 系统 SHALL 将参与者标签从横向排列（`Row`）改为纵向排列（`Column`），每个参与者占一行。
2. WHEN 参与者纵向排列时 THEN 每个参与者标签 SHALL 保持现有的样式（带图标、姓名、角色），但宽度填满可用空间（`fillMaxWidth`）。
3. WHEN 参与者数量为 1 时 THEN 纵向排列 SHALL 与单行横向排列视觉效果一致。
4. WHEN 参与者名字或角色文字过长时 THEN 系统 SHALL 正常显示，不会出现溢出或错位问题。

#### 边界情况
- 参与者列表为空时，整个参与者区域不显示（保持现有逻辑）。
- 纵向排列中每个参与者之间应有适当间距（`8.dp`）。

---

## 技术影响范围

| 需求 | 涉及文件 |
|------|----------|
| 需求 1 | `RecordListScreen.kt`（UI 折叠逻辑、移除卡片中联系人显示） |
| 需求 2 | `RecordListScreen.kt`（编辑对话框）、`MainViewModel.kt`（新增 updateContactName 方法）、`CallRecordDao.kt`（新增按手机号批量更新 SQL）、`CallRecordRepository.kt`（新增 updateContactName 方法） |
| 需求 3 | `MinuteDetailScreen.kt`（参与者布局改为 Column） |
